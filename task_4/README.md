# Задание №4

Есть таблица с логами просмотров вакансий:
</br>
ts – время просмотра</br>
user – ID пользователя</br>
ip – IP-адрес</br>
user_agent – информация об устройстве</br>
vacancy_id – ID вакансии</br>
</br>
1. Сначала разберусь, что вообще считается аномалией</br>
Нормальное поведение пользователя:</br>
•	Заходит на сайт, смотрит несколько вакансий, допустим, 5–10 штук за сессию.</br>
•	Делает это с обычного браузера и с обычными интервалами (не 100 запросов в секунду).</br>
Аномалии возникают в следующих ситуациях:</br>
•	Один пользователь делает сотни просмотров за короткий промежуток времени.</br>
•	С одного IP-адреса заходит большое количество разных пользователей.</br>
•	User-Agent выглядит как скрипт или бот (Python).</br>
•	Вакансию атакуют тысячи просмотров за короткое время.</br>
</br>
2. Проверю самых активных пользователей</br>
SELECT user, COUNT(*) as views</br> 
FROM logs </br>
WHERE ts > NOW() - INTERVAL '1 hour' </br>
GROUP BY user </br>
ORDER BY views DESC </br>
LIMIT 10;</br>
</br>
Что здесь сможем увидеть:</br>
•	Есть ли пользователи с 1000+ просмотров за час?</br>
•	Если да – смотрю их историю: может, это бот или взломанный аккаунт.</br>
</br>
3. Посмотрю подозрительные IP</br>
SELECT ip, COUNT(DISTINCT user) as unique_users, COUNT(*) as total_views </br>
FROM logs </br>
WHERE ts > NOW() - INTERVAL '1 hour'</br> 
GROUP BY ip </br>
ORDER BY total_views DESC </br>
LIMIT 10;</br>
</br>
Что  здесь сможем увидеть:</br>
•	Один IP → много пользователей.</br>
•	Один IP → тысячи запросов (DDoS).</br>
</br>
4. Проверю User-Agent</br>
SELECT user_agent, COUNT(*) as views </br>
FROM logs </br>
WHERE ts > NOW() - INTERVAL '1 hour' </br>
GROUP BY user_agent</br> 
ORDER BY views DESC </br>
LIMIT 10;</br>
</br>
Что здесь сможем увидеть:</br>
•	Пустые строки</br>
•	Один и тот же User-Agent у большого количества пользователей</br>
</br>
5.  Анализ временных закономерностей</br>
Если в данных есть точное время (ts), можно проверить:</br>
•	Запросы ровно через каждые N секунд – явный признак бота.</br>
•	Резкий всплеск активности ночью, когда обычно трафика мало.</br>
</br>
6. Проверю, не атакуют ли конкретную вакансию</br>
SELECT vacancy_id, COUNT(*) as views </br>
FROM logs </br>
WHERE ts > NOW() - INTERVAL '1 hour' </br>
GROUP BY vacancy_id </br>
ORDER BY views DESC </br>
LIMIT 5;</br>
</br>
Что здесь сможем увидеть:</br>
•	Вакансия с 10 000 просмотров за час – возможно, её накручивают.</br>
</br>
7. Какой триггер предложить?</br>
•	Если пользователь делает >50 запросов в минуту → алерт.</br>
•	Если с IP-адреса >100 запросов за 5 минут → алерт.</br>
•	Если User-Agent содержит "Python" → алерт.</br>
</br>
**Вывод**</br>
1.	Сначала простые запросы – топ пользователей, IP-адреса, User-Agent.
2.	Потом углубиться бы в подозрительные случаи – как именно они себя ведут?
3.	Настроить базовые триггеры на очевидные аномалии.


