# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ4

–ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ —Å –ª–æ–≥–∞–º–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤–∞–∫–∞–Ω—Å–∏–π:
</br>
ts ‚Äì –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</br>
user ‚Äì ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</br>
ip ‚Äì IP-–∞–¥—Ä–µ—Å</br>
user_agent ‚Äì –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</br>
vacancy_id ‚Äì ID –≤–∞–∫–∞–Ω—Å–∏–∏

# üïµÔ∏è –ê–Ω–∞–ª–∏–∑ –∞–Ω–æ–º–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤–∞–∫–∞–Ω—Å–∏–π

## üìä 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

+ –ó–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç, —Å–º–æ—Ç—Ä–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∫–∞–Ω—Å–∏–π, –¥–æ–ø—É—Å—Ç–∏–º, 5‚Äì10 —à—Ç—É–∫ –∑–∞ —Å–µ—Å—Å–∏—é.
+ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ (Chrome, Firefox)
+ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (5-30 —Å–µ–∫)

### üö® –ü—Ä–∏–∑–Ω–∞–∫–∏ –∞–Ω–æ–º–∞–ª–∏–π

- –±–æ–ª—å—à–µ 100 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç—É –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- —Å –æ–¥–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞ –∑–∞—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- User Agent: Python/–ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

## üîç 2. SQL-–∞–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

üë• –¢–û–ü-10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
SELECT 
    user,
    COUNT(*) AS views,
    MIN(ts) AS first_view,
    MAX(ts) AS last_view,
    COUNT(*) / EXTRACT(EPOCH FROM (MAX(ts)-MIN(ts))) AS req_per_sec
FROM logs
WHERE ts > NOW() - INTERVAL '1 hour'
GROUP BY user
HAVING COUNT(*) > 50
ORDER BY views DESC
LIMIT 10;
```
–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. –ù–∞–π–¥–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∞–Ω–æ–º–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–æ–π —á–∞—Å—Ç–æ—Ç–æ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ (–±–æ–ª–µ–µ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥).
2. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Å—Å–∏–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—Ç—Å—è –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é –∑–∞–ø—Ä–æ—Å–æ–≤ (>0.5 –≤ —Å–µ–∫—É–Ω–¥—É), —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –±–æ—Ç-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.
3. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: –Ω–æ—á–Ω—ã–µ —á–∞—Å—ã –¥–ª—è –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
   
üåê –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞
```sql
SELECT
    ip,
    COUNT(DISTINCT user) AS unique_users,
    COUNT(*) AS total_views,
    COUNT(DISTINCT user_agent) AS agents_count
FROM logs
WHERE ts > NOW() - INTERVAL '30 minutes'
GROUP BY ip
HAVING 
    COUNT(*) > 100 OR
    COUNT(DISTINCT user) > 5
ORDER BY total_views DESC;
```
–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞:

1. –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã IP-–∞–¥—Ä–µ—Å–∞, —Å –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ—Å—Ç—É–ø–∞–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (DDoS-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å).
2. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ IP —Å–≤—è–∑–∞–Ω—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —á—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VPN.

ü§ñ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –±–æ—Ç–æ–≤
```sql
SELECT
    CASE
        WHEN user_agent LIKE '%Python%' THEN 'Python-bot'
        WHEN user_agent = '' THEN 'Null user agent'
        ELSE 'Normal'
    END AS agent_type,
    COUNT(*) AS requests,
    COUNT(DISTINCT ip) AS unique_ips
FROM logs
GROUP BY agent_type
ORDER BY requests DESC;
```
–ë–æ—Ç—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

1. –ß–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–º–µ–µ—Ç User-Agent, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ Python –∏–ª–∏ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
2. –¢–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —á–∞—Å—Ç–æ –∏–¥—É—Ç —Å –≤—ã—Å–æ–∫–æ–π —á–∞—Å—Ç–æ—Ç–æ–π –∏ –º–æ–≥—É—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –Ω–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä–≤–µ—Ä–∞.
   
## üõ°Ô∏è 3. –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –¢–∏–ø –∞–Ω–æ–º–∞–ª–∏–∏               | üö® –ü–æ—Ä–æ–≥ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è      | üéØ –î–µ–π—Å—Ç–≤–∏–µ                          | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç          |
|----------------------------|--------------------------|-------------------------------------|--------------------|
| **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** | >50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É    | –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è                | `–°—Ä–µ–¥–Ω–∏–π` üì¢       |
| **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å IP-–∞–¥—Ä–µ—Å–∞**    | >100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 5 –º–∏–Ω—É—Ç | –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP             | `–í—ã—Å–æ–∫–∏–π` üî¥       |
| **–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π User-Agent** | –°–æ–¥–µ—Ä–∂–∏—Ç "Python"      | –ó–∞–ø–∏—Å—å –≤ –ª–æ–≥ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ | `–ù–∏–∑–∫–∏–π` üü°        |
| **–ü—É—Å—Ç–æ–π User-Agent**       | –õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ        | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ CAPTCHA                  | `–°—Ä–µ–¥–Ω–∏–π` üì¢       |

### –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:
- üî¥ ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ)
- üì¢ ‚Äî –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è)
- üü° ‚Äî –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)

