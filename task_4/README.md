# Задание №4

Есть таблица с логами просмотров вакансий:

ts – время просмотра</br>
user – ID пользователя</br>
ip – IP-адрес</br>
user_agent – информация об устройстве</br>
vacancy_id – ID вакансии</br>

1. Сначала разберусь, что вообще считается аномалией
Нормальное поведение пользователя:
•	Заходит на сайт, смотрит несколько вакансий, допустим, 5–10 штук за сессию.
•	Делает это с обычного браузера и с обычными интервалами (не 100 запросов в секунду).
Аномалии возникают в следующих ситуациях:
•	Один пользователь делает сотни просмотров за короткий промежуток времени.
•	С одного IP-адреса заходит большое количество разных пользователей.
•	User-Agent выглядит как скрипт или бот (Python-requests, curl).
•	Вакансию атакуют тысячи просмотров за короткое время.

2. Проверю самых активных пользователей
SELECT user, COUNT(*) as views 
FROM logs 
WHERE ts > NOW() - INTERVAL '1 hour' 
GROUP BY user 
ORDER BY views DESC 
LIMIT 10;
Что здесь сможем увидеть:
•	Есть ли пользователи с 1000+ просмотров за час?
•	Если да – смотрю их историю: может, это бот или взломанный аккаунт.

3. Посмотрю подозрительные IP
SELECT ip, COUNT(DISTINCT user) as unique_users, COUNT(*) as total_views 
FROM logs 
WHERE ts > NOW() - INTERVAL '1 hour' 
GROUP BY ip 
ORDER BY total_views DESC 
LIMIT 10;
Что  здесь сможем увидеть:
•	Один IP → много пользователей.
•	Один IP → тысячи запросов (DDoS).

4. Проверю User-Agent
SELECT user_agent, COUNT(*) as views 
FROM logs 
WHERE ts > NOW() - INTERVAL '1 hour' 
GROUP BY user_agent 
ORDER BY views DESC 
LIMIT 10;
Что здесь сможем увидеть:
•	Пустые строки
•	Один и тот же User-Agent у большого количества пользователей

5.  Анализ временных закономерностей
Если в данных есть точное время (ts), можно проверить:
•	Запросы ровно через каждые N секунд – явный признак бота.
•	Резкий всплеск активности ночью, когда обычно трафика мало.

6. Проверю, не атакуют ли конкретную вакансию
SELECT vacancy_id, COUNT(*) as views 
FROM logs 
WHERE ts > NOW() - INTERVAL '1 hour' 
GROUP BY vacancy_id 
ORDER BY views DESC 
LIMIT 5;
Что здесь сможем увидеть:
•	Вакансия с 10 000 просмотров за час – возможно, её накручивают.

7. Какой триггер предложить?
•	Если пользователь делает >50 запросов в минуту → алерт.
•	Если с IP-адреса >100 запросов за 5 минут → алерт.
•	Если User-Agent содержит "Python" → алерт.

**Вывод**
1.	Сначала простые запросы – топ пользователей, IP-адреса, User-Agent.
2.	Потом углубиться бы в подозрительные случаи – как именно они себя ведут?
3.	Настроить базовые триггеры на очевидные аномалии.


